<div class="container">
  <div class="header">
    <%= link_to family_dashboard_path do %>
      <span class="back-arrow"><</span>
    <% end %>
    <h1>Ajouter un privilège</h1>
  </div>

  <%= simple_form_for @award do |f| %>
    <%= f.input :name, label: false, placeholder: "Nom du privilège", required: true, input_html: { class: 'form__input' } %>
    <% if @award.errors[:name].present? %>
      <div class="form__error">Le privilège doit avoir un nom.</div>
    <% end %>

    <%= f.input :description, label: false, placeholder: "Description du privilège", input_html: { class: 'form__textarea' } %>

    <%= f.label :value, 'Nombre de points' %>
    <div class="form__points">
      <button type="button" onclick="changePoints(-1)" class="form__points-button">-</button>
      <span class="form__points-display">0</span>
      <%= f.input :value, as: :hidden, input_html: { id: 'points-input', value: 0 } %>
      <button type="button" onclick="changePoints(1)" class="form__points-button">+</button>
    </div>

    <div class="form__radio-group">
      <% ['quotidien', 'hebdomadaire', 'mensuel'].each do |period| %>
        <%= f.radio_button :periodicity, period, id: "periodicity_#{period}", class: 'form__radio-input' %>
        <%= f.label "periodicity_#{period}", period.capitalize, class: 'form__radio-label' %>
      <% end %>
    </div>

    <%= f.label :children, 'Sélectionner les enfants' %>
    <div class="form__child-select">
      <% @children.each do |child| %>
        <div class="form__child-chip" data-child-id="<%= child.id %>">
          <span class="form__user-chip--name"><%= child.first_name %></span>
          <div class="form__child-select-icon">+</div>
        </div>
      <% end %>
    </div>

    <%= f.submit 'Ajouter un privilège', class: 'form__submit-button' %>
  <% end %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const childChips = document.querySelectorAll('.form__child-chip');
  childChips.forEach(chip => {
    chip.addEventListener('click', function() {
      this.classList.toggle('selected');
      const selectIcon = this.querySelector('.form__child-select-icon');
      if (this.classList.contains('selected')) {
        selectIcon.textContent = '×';
      } else {
        selectIcon.textContent = '+';
      }
    });
  });

  window.changePoints = function(value) {
    const pointsInput = document.getElementById('points-input');
    const pointsDisplay = document.querySelector('.form__points-display');
    let currentPoints = parseInt(pointsInput.value, 10);
    currentPoints = Math.max(0, currentPoints + value);
    pointsInput.value = currentPoints;
    pointsDisplay.textContent = currentPoints;
  };
});
</script>
