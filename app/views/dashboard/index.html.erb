<div data-controller="mobile-menu">
  <div class="container">
    <div class="headers__container">
      <h1>Famille <%= @family.name %></h1>
    </div>
  </div>
  <div class="child-card__wrapper">
    <% @family.children.each do |child| %>
      <div class="child-card">
        <header class="child-card__header">
          <div class="child-card__header__identity">
            <div class="child-card__header__avatar">
              <%= image_tag("super.png", alt: "Photo #{child.first_name}") %>
            </div>
            <h1 class="child-card__header__name"><%= child.first_name %></h1>
          </div>
          <div class="child-card__header__points-container">
            <div class="child-card__header__points child-card__header__points--day">
              <span class="child-card__header__points-value" id="child-<%= child.id %>-day_points"><%= child.day_points %></span>
            </div>
            <div class="child-card__header__points child-card__header__points--week">
              <span class="child-card__header__points-value" id="child-<%= child.id %>-week_points"><%= child.week_points %></span>
            </div>
            <div class="child-card__header__points child-card__header__points--month">
              <span class="child-card__header__points-value" id="child-<%= child.id %>-month_points"><%= child.month_points %></span>
            </div>
            <span data-action="click->mobile-menu#show"><i class="fa-solid fa-ellipsis-vertical child-card__header__menu"></i></span>
          </div>
        </header>
      </div>
    <% end %>
  </div>
  <div class="family-background">
    <div class="children-list">
      <% @family.children.each do |child| %>
        <div class="child-details-container">
          <div class="child-header">
            <div class="child-avatar">
              <% if child.respond_to?(:avatar_url) && child.avatar_url.present? %>
                <%= image_tag child.avatar_url, alt: child.first_name %>
              <% else %>
                <div class="default-avatar"><%= child.first_name[0] %></div>
              <% end %>
            </div>
            <div class="child-info">
              <div class="child-name"><%= child.first_name %></div>
              <div class="rewards">
                <span class="badge yellow"><%= child.day_points %></span>
                <span class="badge green"><%= child.week_points %></span>
                <span class="badge blue"><%= child.month_points %></span>
              </div>
            </div>
            <div class="hamburger-btn" data-action="click->mobile-menu#show">
              <div class="dropdown">
                <i class="fa fa-bars dropdown-toggle" data-toggle="dropdown"></i>
                <div class="dropdown-menu">
                  <%= link_to new_task_path(child_id: child.id), class: "dropdown-item" do %>
                    <i class="fa fa-check"></i> Ajouter une tâche
                  <% end %>
                  <%= link_to tasks_path(child_id: child.id), class: "dropdown-item" do %>
                    <i class="fa fa-trash"></i> Supprimer une tâche
                  <% end %>
                  <%= link_to new_award_path(child_id: child.id), class: "dropdown-item" do %>
                    <i class="fa fa-smile"></i> Ajouter un privilège
                  <% end %>
                  <%= link_to "#", class: "dropdown-item" do %>
                    <i class="fa fa-gem"></i> Malle aux trésors
                  <% end %>
                  <%= link_to family_dashboard_path, class: "dropdown-item" do %>
                    <i class="fa fa-home"></i> Retour à ma famille
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          <div class="tasks">
            <% child.tasks.each do |task| %>
              <div class="task <%= 'child-card__body__award--disabled' if task.validated %>" data-controller="task-done" data-task-id="<%= task.id %>">id = <%= task.id %> valeur = <%= task.value %>
                <div class="task-location">
                  <i class="fa fa-map-marker-alt"></i>
                </div>
                <div class="task-name">
                  <%= task.name %>
                </div>
                <div class="task-switch" data-task-done-target="taskDone" data-action="change->task-done#updateTask">
                  <input type="checkbox" <%= 'checked' if task.done %> <%= 'checked disabled' if task.validated %> class="task-toggle">
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <div class="tab-bar">
    <%= link_to "#", class: "tab-bar-item" do %>
      <i class="fa fa-users"></i>
      <span>Ma famille</span>
    <% end %>
    <%= link_to "#", class: "tab-bar-item" do %>
      <i class="fa fa-calendar"></i>
      <span>Calendrier</span>
    <% end %>
    <%= link_to "#", class: "tab-bar-item" do %>
      <i class="fa fa-check"></i>
      <span>Tâches</span>
    <% end %>
    <%= link_to "#", class: "tab-bar-item" do %>
      <i class="fa fa-smile"></i>
      <span>Privilèges</span>
    <% end %>
  </div>
  <%= render "shared/mobile-menu" %>
</div>